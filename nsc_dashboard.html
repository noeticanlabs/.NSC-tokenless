<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSC Tokenless v1.1 Explorer</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-foreground: white;
            --secondary: #64748b;
            --background: #f8fafc;
            --foreground: #0f172a;
            --muted: #f1f5f9;
            --muted-foreground: #64748b;
            --border: #e2e8f0;
            --success: #22c55e;
            --warning: #eab308;
            --error: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background);
            color: var(--foreground);
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--primary-foreground);
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-primary:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--foreground);
        }

        .btn-outline:hover {
            background: var(--muted);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .card-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
        }

        .card-content {
            padding: 16px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--muted-foreground);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }

        .tab:hover {
            color: var(--foreground);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            gap: 16px;
        }

        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-5 { grid-template-columns: repeat(5, 1fr); }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        input[readonly] {
            background: var(--muted);
        }

        textarea {
            min-height: 120px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
        }

        .node-item {
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--muted);
            margin-bottom: 8px;
        }

        .node-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .node-id {
            font-family: monospace;
            font-weight: 700;
        }

        .type-tag {
            font-size: 11px;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .node-payload {
            font-size: 13px;
            color: var(--muted-foreground);
        }

        .seq-flow {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .seq-item {
            padding: 6px 12px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            font-family: monospace;
        }

        .seq-arrow {
            color: var(--muted-foreground);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
        }

        .status-success {
            background: #dcfce7;
            color: #166534;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-warning {
            background: #fef9c3;
            color: #854d0e;
        }

        .gate-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .gate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--muted);
        }

        .check-icon {
            width: 20px;
            height: 20px;
        }

        .check-success { color: var(--success); }
        .check-error { color: var(--error); }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: var(--muted);
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 13px;
        }

        .glyph-grid {
            display: grid;
            gap: 8px;
            grid-template-columns: repeat(16, 1fr);
        }

        .glyph-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-family: monospace;
            border-radius: 2px;
        }

        .glyph-pos { background: #dcfce7; color: #166534; }
        .glyph-neg { background: #fee2e2; color: #991b1b; }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--muted);
        }

        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }

        .font-mono { font-family: monospace; }
        .text-sm { font-size: 14px; }
        .text-xs { font-size: 12px; }
        .text-lg { font-size: 18px; }
        .text-2xl { font-size: 24px; }
        .font-bold { font-weight: 700; }

        .text-muted { color: var(--muted-foreground); }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .grid-5 { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>NSC Tokenless v1.1 Explorer</h1>
            <div class="flex gap-2">
                <button class="btn btn-outline btn-sm" onclick="exportModule()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export JSON
                </button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('module')">Module</button>
            <button class="tab" onclick="switchTab('execution')">Execution</button>
            <button class="tab" onclick="switchTab('gates')">Gates</button>
            <button class="tab" onclick="switchTab('codebook')">GLLL Codebook</button>
        </div>

        <!-- Module Tab -->
        <div id="tab-module" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    <span class="card-title">Module Definition</span>
                </div>
                <div class="card-content">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>Module ID</label>
                            <input type="text" id="module-id" value="psi_governed_example" readonly>
                        </div>
                        <div class="form-group">
                            <label>Version</label>
                            <input type="text" id="module-version" value="1.1.0" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Registry Reference</label>
                        <input type="text" id="registry-ref" value="default_registry_v1" readonly>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span class="card-title">Nodes (5)</span>
                </div>
                <div class="card-content" id="nodes-list">
                    <!-- Nodes rendered by JS -->
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                        <polyline points="2 17 12 22 22 17"/>
                        <polyline points="2 12 12 17 22 12"/>
                    </svg>
                    <span class="card-title">Execution Order (SEQ)</span>
                </div>
                <div class="card-content">
                    <div class="seq-flow" id="seq-flow">
                        <!-- SEQ rendered by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Execution Tab -->
        <div id="tab-execution" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                    </svg>
                    <span class="card-title">Execution Controls</span>
                </div>
                <div class="card-content">
                    <button id="execute-btn" class="btn btn-primary" onclick="executeModule()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Execute Module
                    </button>
                    <button class="btn btn-outline" onclick="resetExecution()" style="margin-left: 12px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"/>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                        </svg>
                        Reset
                    </button>
                </div>
            </div>

            <div id="execution-result" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <span class="card-title">Execution Result</span>
                    </div>
                    <div class="card-content">
                        <div class="grid grid-3 mb-4">
                            <div>
                                <label>Status</label>
                                <div id="exec-status" class="status-badge status-success">SUCCESS</div>
                            </div>
                            <div>
                                <label>Nodes Executed</label>
                                <div id="exec-nodes" class="text-lg font-mono">5</div>
                            </div>
                            <div>
                                <label>Duration</label>
                                <div id="exec-duration" class="text-lg font-mono">1.234ms</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Node Results</label>
                            <div id="node-results" class="grid grid-5" style="margin-top: 8px;">
                                <!-- Results rendered by JS -->
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label>Receipts</label>
                            <div id="receipts-list" style="margin-top: 8px;">
                                <!-- Receipts rendered by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gates Tab -->
        <div id="tab-gates" class="tab-content">
            <div id="gate-report-placeholder" class="card">
                <div class="card-content" style="padding: 48px; text-align: center; color: var(--muted-foreground);">
                    Execute a module to see gate evaluation results
                </div>
            </div>

            <div id="gate-report" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        <span class="card-title">Gate Evaluation</span>
                    </div>
                    <div class="card-content">
                        <div class="grid grid-2 mb-4">
                            <div>
                                <label>Decision</label>
                                <div id="gate-decision" class="status-badge status-success">PASS</div>
                            </div>
                            <div>
                                <label>Digest</label>
                                <div id="gate-digest" class="font-mono text-xs" style="word-break: break-all;">abc123def456</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Hard Gates</span>
                        </div>
                        <div class="card-content">
                            <div class="gate-item">
                                <span>NaN Free</span>
                                <svg id="check-nan" class="check-icon check-success" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="gate-item">
                                <span>Inf Free</span>
                                <svg id="check-inf" class="check-icon check-success" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="gate-item">
                                <span>Positive Values</span>
                                <svg id="check-pos" class="check-icon check-success" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Soft Gates (Residuals)</span>
                        </div>
                        <div class="card-content">
                            <div class="metric-row">
                                <span>Physics Residual</span>
                                <span id="res-phys" class="font-mono">1.00e-3</span>
                            </div>
                            <div class="metric-row">
                                <span>Constraint Residual</span>
                                <span id="res-cons" class="font-mono">2.00e-3</span>
                            </div>
                            <div class="metric-row">
                                <span>Numeric Residual</span>
                                <span id="res-num" class="font-mono">5.00e-4</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GLLL Codebook Tab -->
        <div id="tab-codebook" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">GLLL Codebook (n=16)</span>
                </div>
                <div class="card-content">
                    <div class="grid grid-2">
                        <div>
                            <label>Codebook Version</label>
                            <div class="font-mono">hadamard_n16_v1</div>
                        </div>
                        <div>
                            <label>Vector Length (n)</label>
                            <div class="font-mono">16</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Hadamard Matrix (4x4 sample)</span>
                </div>
                <div class="card-content">
                    <div id="hadamard-viz" style="font-family: monospace; font-size: 12px;">
                        <!-- Hadamard matrix rendered by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Section -->
        <div class="card">
            <div class="card-header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                <span class="card-title">Import Module JSON</span>
            </div>
            <div class="card-content">
                <textarea id="import-json" placeholder='{"module_id": "...", "nodes": [...]}'></textarea>
                <button class="btn btn-primary btn-sm mt-4" onclick="importModule()">
                    Load Module
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample Module Data
        let currentModule = {
            module_id: "psi_governed_example",
            version: "1.1.0",
            nodes: [
                { id: 1, type_tag: { tag: "float" }, payload: { kind: "CONST", value: 10.0 } },
                { id: 2, type_tag: { tag: "float" }, payload: { kind: "CONST", value: 3.0 } },
                { id: 3, type_tag: { tag: "float" }, payload: { kind: "APPLY", op_id: 1001, inputs: [1, 2] } },
                { id: 4, type_tag: { tag: "float" }, payload: { kind: "CONST", value: 2.0 } },
                { id: 5, type_tag: { tag: "float" }, payload: { kind: "APPLY", op_id: 1002, inputs: [3, 4] } },
            ],
            seq: [1, 2, 3, 4, 5],
            entrypoints: [5],
            registry_ref: "default_registry_v1"
        };

        let executionResult = null;
        let gateReport = null;

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // Render nodes
        function renderNodes() {
            const container = document.getElementById('nodes-list');
            container.innerHTML = currentModule.nodes.map(node => `
                <div class="node-item">
                    <div class="node-header">
                        <span class="node-id">Node ${node.id}</span>
                        <span class="type-tag">${node.type_tag.tag}</span>
                    </div>
                    <div class="node-payload">
                        ${node.payload.kind}
                        ${node.payload.kind === 'CONST' ? '= ' + node.payload.value : ''}
                        ${node.payload.kind === 'APPLY' ? 'op_id=' + node.payload.op_id + ' inputs=[' + node.payload.inputs?.join(', ') + ']' : ''}
                    </div>
                </div>
            `).join('');
        }

        // Render SEQ flow
        function renderSEQ() {
            const container = document.getElementById('seq-flow');
            const seq = currentModule.seq;
            container.innerHTML = seq.map((id, idx) => `
                ${idx > 0 ? '<span class="seq-arrow">→</span>' : ''}
                <span class="seq-item">${id}</span>
            `).join('');
        }

        // Render Hadamard matrix visualization
        function renderHadamard() {
            const container = document.getElementById('hadamard-viz');
            const h4 = [
                [1, 1, 1, 1],
                [1, -1, 1, -1],
                [1, 1, -1, -1],
                [1, -1, -1, 1]
            ];
            
            container.innerHTML = h4.map(row => 
                row.map(v => v === 1 ? '●' : '○').join(' ')
            ).join('<br>');
        }

        // Execute module
        function executeModule() {
            const btn = document.getElementById('execute-btn');
            btn.disabled = true;
            btn.innerHTML = '⏸ Running...';

            setTimeout(() => {
                // Mock execution result
                executionResult = {
                    success: true,
                    node_count: currentModule.nodes.length,
                    outputs: { 1: 10.0, 2: 3.0, 3: 13.0, 4: 2.0, 5: 11.0 },
                    duration_ms: 1.234,
                    receipts: currentModule.nodes
                        .filter(n => n.payload.kind === 'APPLY')
                        .map(n => ({
                            node_id: n.id,
                            op_id: n.payload.op_id,
                            result: n.id === 3 ? 13.0 : 11.0
                        }))
                };

                // Mock gate report
                gateReport = {
                    timestamp: new Date().toISOString(),
                    hard_gates: { pass_hard: true, nan_free: true, inf_free: true, positive_values: true },
                    soft_gates: { all_pass: true, phys_value: 0.001, cons_value: 0.002, num_value: 0.0005 },
                    decision: "PASS",
                    digest: "abc123def456789"
                };

                displayResults();
                
                btn.disabled = false;
                btn.innerHTML = '▶ Execute Module';
            }, 500);
        }

        // Display execution results
        function displayResults() {
            document.getElementById('execution-result').style.display = 'block';
            
            const statusEl = document.getElementById('exec-status');
            statusEl.textContent = executionResult.success ? 'SUCCESS' : 'FAILED';
            statusEl.className = 'status-badge ' + (executionResult.success ? 'status-success' : 'status-error');
            
            document.getElementById('exec-nodes').textContent = executionResult.node_count;
            document.getElementById('exec-duration').textContent = executionResult.duration_ms.toFixed(3) + 'ms';

            // Node results
            document.getElementById('node-results').innerHTML = Object.entries(executionResult.outputs)
                .map(([id, value]) => `
                    <div style="padding: 8px; background: var(--muted); border-radius: 4px; text-align: center;">
                        <div style="font-size: 11px; color: var(--muted-foreground);">Node ${id}</div>
                        <div class="font-mono font-bold">${typeof value === 'number' ? value.toFixed(4) : value}</div>
                    </div>
                `).join('');

            // Receipts
            document.getElementById('receipts-list').innerHTML = executionResult.receipts
                .map(r => `
                    <div class="receipt-item">
                        <span>Node ${r.node_id} (op ${r.op_id})</span>
                        <span class="font-mono">${r.result.toFixed(6)}</span>
                    </div>
                `).join('');

            // Gate report
            document.getElementById('gate-report-placeholder').style.display = 'none';
            document.getElementById('gate-report').style.display = 'block';

            const decisionEl = document.getElementById('gate-decision');
            decisionEl.textContent = gateReport.decision;
            decisionEl.className = 'status-badge ' + 
                (gateReport.decision === 'PASS' ? 'status-success' : 
                 gateReport.decision === 'WARN' ? 'status-warning' : 'status-error');
            
            document.getElementById('gate-digest').textContent = gateReport.digest;

            // Hard gates
            updateCheck('check-nan', gateReport.hard_gates.nan_free);
            updateCheck('check-inf', gateReport.hard_gates.inf_free);
            updateCheck('check-pos', gateReport.hard_gates.positive_values);

            // Soft gates (residuals)
            document.getElementById('res-phys').textContent = gateReport.soft_gates.phys_value.toExponential(2);
            document.getElementById('res-cons').textContent = gateReport.soft_gates.cons_value.toExponential(2);
            document.getElementById('res-num').textContent = gateReport.soft_gates.num_value.toExponential(2);
        }

        function updateCheck(id, passed) {
            const el = document.getElementById(id);
            el.innerHTML = passed 
                ? '<polyline points="20 6 9 17 4 12"/>'
                : '<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>';
            el.className = 'check-icon ' + (passed ? 'check-success' : 'check-error');
        }

        // Reset execution
        function resetExecution() {
            executionResult = null;
            gateReport = null;
            document.getElementById('execution-result').style.display = 'none';
            document.getElementById('gate-report-placeholder').style.display = 'block';
            document.getElementById('gate-report').style.display = 'none';
        }

        // Import module
        function importModule() {
            try {
                const json = document.getElementById('import-json').value;
                currentModule = JSON.parse(json);
                renderNodes();
                renderSEQ();
                resetExecution();
                alert('Module loaded successfully!');
            } catch (e) {
                alert('Invalid JSON: ' + e.message);
            }
        }

        // Export module
        function exportModule() {
            const blob = new Blob([JSON.stringify(currentModule, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentModule.module_id + '.json';
            a.click();
        }

        // Initialize
        renderNodes();
        renderSEQ();
        renderHadamard();
    </script>
</body>
</html>
